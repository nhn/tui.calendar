<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <title>TOAST UI Calendar Custom Schedule Layout For Timegrid(Week, Day) DEMO</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="https://uicdn.toast.com/tui.time-picker/latest/tui-time-picker.css">
    <link rel="stylesheet" type="text/css" href="https://uicdn.toast.com/tui.date-picker/latest/tui-date-picker.css">
    <link rel="stylesheet" type="text/css" href="../dist/tui-calendar.css" />
    <link rel="stylesheet" type="text/css" href="./css/default.css"></link>
    <link rel="stylesheet" type="text/css" href="./css/icons.css"></link>
    <style>
      #lnb {
        position: absolute;
        width: 205px;
        border-right: 1px solid salmon;
        top: 0;
        bottom: 0;
      }
      #btn-new-schedule {
        display: none;
      }
      .code-html {
        position: absolute;
        left: 205px;
        right: 0;
        bottom: 0;
        top: 0;
      }
      .renderer-mode-container {
        display: inline-block;
      }
      .title {
        font-size: 14px;
        font-weight: 500;
      }
      .renderer-mode-groups {
        display: inline-block;
      }
      .renderer-mode-groups label {
        margin-left: 10px;
      }
      .duplicate-schedule {
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      .duplicate-schedule .tui-full-calendar-time-resize-handle {
        display: none;
        pointer-events: none;
      }

      .duplicate-schedule.is-focus .tui-full-calendar-time-resize-handle{
        display: block;
        pointer-events: auto;
      }

      .major-schedule.is-not-focus .tui-full-calendar-time-resize-handle {
        display: none;
        pointer-events: none;
      }
    </style>
  </head>
  <body>
    <div id="lnb">
        <div class="lnb-new-schedule">
            <button id="btn-new-schedule" type="button" class="btn btn-default btn-block lnb-new-schedule-btn" data-toggle="modal">
                New schedule</button>
        </div>
        <div id="lnb-calendars" class="lnb-calendars">
            <div>
                <div class="lnb-calendars-item">
                    <label>
                        <input class="tui-full-calendar-checkbox-square" type="checkbox" value="all" checked>
                        <span></span>
                        <strong>View all</strong>
                    </label>
                </div>
            </div>
            <div id="calendarList" class="lnb-calendars-d1">
            </div>
        </div>
        <div class="lnb-footer">
            © NHN Corp.
        </div>
    </div>

    <div class="code-html">
      <div id="menu">
        <span id="menu-navi">
          <button type="button" class="btn btn-default btn-sm move-today" data-action="move-today">Today</button>
          <button type="button" class="btn btn-default btn-sm move-day" data-action="move-prev">
            <i class="calendar-icon ic-arrow-line-left" data-action="move-prev"></i>
          </button>
          <button type="button" class="btn btn-default btn-sm move-day" data-action="move-next">
            <i class="calendar-icon ic-arrow-line-right" data-action="move-next"></i>
          </button>
        </span>
        <span id="renderRange" class="render-range"></span>

        <div class="renderer-mode-container">
          <span class="title">Select Schedule Layout : </span>
          <div class="renderer-mode-groups">
              <label><input type="radio" name="rendererMode" value="default"> Default</label>
              <label><input type="radio" name="rendererMode" value="custom" checked> Custom</label>
          </div>
        </div>

        <div>
          <label><input type="checkbox" id="useRandomSchedule"> Use random schedule</label>
        </div>
      </div>

      <div id="calendar"></div>
    </div>

    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="https://uicdn.toast.com/tui.code-snippet/latest/tui-code-snippet.min.js"></script>
    <script type="text/javascript" src="https://uicdn.toast.com/tui.time-picker/latest/tui-time-picker.min.js"></script>
    <script type="text/javascript" src="https://uicdn.toast.com/tui.date-picker/latest/tui-date-picker.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.20.1/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chance/1.0.13/chance.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.15/lodash.min.js"></script>
    <script src="../dist/tui-calendar.js"></script>
    <script src="./js/data/calendars.js"></script>
    <script src="./js/data/schedules.js"></script>
    <script src="./js/data/duplicate-schedules.js"></script>
    <script src="./js/theme/dooray.js"></script>
    <script>
      function _rest(arrayLike, num = 1) {
        return Array.prototype.slice.call(arrayLike, num);
      }

      function _is_object(obj) {
        return typeof obj === 'object' && !!obj;
      }

      function _keys(obj) {
        return _is_object(obj) ? Object.keys(obj) : [];
      }

      function _each(obj, iter) {
        const keys = _keys(obj);

        for (let i = 0; i < keys.length; i += 1) {
            iter(obj[keys[i]]);
        }

        return obj;
      }

      function _reduce(list, iter, memo) {
        if (arguments.length == 2) {
          memo = list[0];
          list = _rest(list);
        }

        _each(list, (val) => {
          memo = iter(memo, val);
        });
        return memo;
      }

      function _curryr(fn) {
        return function(a, b) {
          return arguments.length == 2 ? fn(a, b) : function(b) {return fn(b, a)}
        };
      }

      function _push(obj, key, val) {
        (obj[key] = obj[key] || []).push(val);
        return obj;
      }

      var _groupBy = _curryr((data, iter) => {
        return _reduce(data, (grouped, val) => {
          const key = iter(val);
          return _push(grouped, iter(val), val);
        }, {});
      });

    var calendarList = document.getElementById('calendarList');
    var html = [];

    CalendarList.forEach(function(calendar) {
        html.push('<div class="lnb-calendars-item"><label>' +
            '<input type="checkbox" class="tui-full-calendar-checkbox-round" value="' + calendar.id + '" checked>' +
            '<span style="border-color: ' + calendar.borderColor + '; background-color: ' + calendar.borderColor + ';"></span>' +
            '<span>' + calendar.name + '</span>' +
            '</label></div>'
        );
    });

    calendarList.innerHTML = html.join('\n');
    </script>

<script>
  const DEFAULT_DUPLICATE_SCHEDULE_WIDTH = 9;

  function permuteSchedules(schedules) {
    // 중복 데이터 isMajor 맨 뒤로 재배열
    return schedules.sort((a, b) => {
      // console.log(_.includes(_.get(a, 'model.customClass'), 'major-schedule'), _.includes(_.get(b, 'model.customClass'), 'major-schedule'))
        if (a && _.includes(_.get(a, 'model.customClass'), 'major-schedule')) {
            return 1;
        }

        else if (b && _.includes(_.get(b, 'model.customClass'), 'major-schedule')) {
            return -1;
        }

        else {
            return 0;
        }
    });
  }

  function _hasForcusedSchedule(schedules) {
    return schedules.some(schedule => _.get(schedule, 'model.isFocused'));
  }

  function customScheduleLayoutPositionHandler({schedulesForRow, leftPercents, widthPercent}) {
      const includeEmptyMatrix = schedulesForRow.some(el => !el);
      const groupBySId = _groupBy(schedulesForRow, s => s && s.model && s.model.id);

      const newArrs = [];
      for(let m = 0; m < schedulesForRow.length; m++) {
        const schedule = schedulesForRow[m];

        if (!schedule) {
          newArrs.push(schedule);
          continue;
        }

        const scheduleModelId = schedule.model.id;
        const scheduleCount = groupBySId[scheduleModelId].length;

        if (scheduleCount === 1) {
          newArrs.push(schedule);
          continue;
        }

        const hasSchedule = newArrs.some(schedule => {
          const isArraySchedule = Array.isArray(schedule);

          return isArraySchedule && schedule.some(s => s && s.model && s.model.id === scheduleModelId);
        });

        if (scheduleCount > 1 && !hasSchedule) {
          newArrs.push(groupBySId[scheduleModelId]);
        }
      }

      // 중복 일정을 하나로 취급
      const scheduleCount = newArrs.length;

      // customWidthPercent = includeEmptyMatrix ? widthPercent : 100 / scheduleCount;
      // leftPercents = includeEmptyMatrix ? leftPercents : [...Array(scheduleCount).keys()].map(i => widthPercent * i);


      const newSchedules1 = [];

      for (let i = 0; i < newArrs.length; i++) {
        let schedules = newArrs[i];

        if (!schedules) {
          newSchedules1.push(schedules);
          continue;
        }

        const isArraySchedule = Array.isArray(schedules);

        if (isArraySchedule) {
          schedules = permuteSchedules(schedules);
          //console.log(schedules)
          const hasForcusedSchedule = _hasForcusedSchedule(schedules);
          const afterScheduleWidth = `${(leftPercents.length - 2 - newSchedules1.length) * widthPercent}%`;
          //console.log(afterScheduleWidth, leftPercents);

          schedules.forEach((schedule, dIdx) => {
            let leftPercent = 0;
            if (dIdx === 0) {
              leftPercent = leftPercents[newSchedules1.length];
            } else {
              leftPercent = schedules[0].left;
            }
            const {left, width} = _getScheduleWidthAndLeft(dIdx, schedule, leftPercent, widthPercent * 2, afterScheduleWidth, hasForcusedSchedule);
            console.log(left, width, afterScheduleWidth);
            schedule.left = left;
            schedule.width = width;

            newSchedules1.push(schedule);
          });
        } else {
          // 중복이 아닌 스케줄
          schedules.left = leftPercents[newSchedules1.length];
          schedules.width = schedules.hasCollide ? widthPercent : null;

          newSchedules1.push(schedules);
        }
      }

      leftPercents = newSchedules1.map((s, idx) => {
          return s ? s.left : leftPercents[idx];
      });


      return {
          schedules: newSchedules1,
          widthPercent: widthPercent,
          leftPercents: leftPercents
      };
  }

  </script>

    <script type="text/javascript" class="code-js">
    var cal = new tui.Calendar('#calendar', {
      defaultView: 'week',
      calendars: CalendarList,
      week: {
        customScheduleLayout: {
          positionHandler: customScheduleLayoutPositionHandler
        }
      },
      theme: THEME_DOORAY,
      useCreationPopup: true,
      useDetailPopup: false,
      template: {
          milestone: function(model) {
              return '<span class="calendar-font-icon ic-milestone-b"></span> <span style="background-color: ' + model.bgColor + '">' + model.title + '</span>';
          },
          allday: function(schedule) {
              return getTimeTemplate(schedule, true);
          },
          time: function(schedule) {
              return getTimeTemplate(schedule, false);
          }
      }
    });
    </script>


    <script>

    var defaultSchedules = [
      duplicateSchedules1,
      duplicateSchedules2,
      duplicateSchedules4,
      duplicateSchedules5,
      duplicateSchedules10,
      duplicateSchedules11,
      data12,
      data13,
      data14,
      data15,
      data16,
      data17,
      data18,
      data19,
      data20
    ];

    function getTimeTemplate(schedule, isAllDay) {
        var html = [];
        var start = moment(schedule.start.toUTCString());
        if (!isAllDay) {
            html.push('<strong>' + start.format('HH:mm') + '</strong> ');
        }
        if (schedule.isPrivate) {
            html.push('<span class="calendar-font-icon ic-lock-b"></span>');
            html.push(' Private');
        } else {
            if (schedule.isReadOnly) {
                html.push('<span class="calendar-font-icon ic-readonly-b"></span>');
            } else if (schedule.recurrenceRule) {
                html.push('<span class="calendar-font-icon ic-repeat-b"></span>');
            } else if (schedule.attendees.length) {
                html.push('<span class="calendar-font-icon ic-user-b"></span>');
            } else if (schedule.location) {
                html.push('<span class="calendar-font-icon ic-location-b"></span>');
            }
            html.push(' ' + schedule.title);
        }
        return html.join('');
    }

    cal.createSchedules(defaultSchedules);

    // event handlers
    cal.on({
        'clickMore': function(e) {
            console.log('clickMore', e);
        },
        'clickSchedule': function({event, schedule}) {
            console.log('clickSchedule', event, schedule);
            _highlightSchedule(schedule);
        },
        'clickDayname': function(date) {
            console.log('clickDayname', date);
        },
        'beforeCreateSchedule': function(e) {
            console.log('beforeCreateSchedule', e);
            saveNewSchedule(e);
        },
        'beforeUpdateSchedule': function(e) {
            console.log('beforeUpdateSchedule', e);
            e.schedule.start = e.start;
            e.schedule.end = e.end;
            cal.updateSchedule(e.schedule.id, e.schedule.calendarId, e.schedule);
        },
        'beforeDeleteSchedule': function(e) {
            console.log('beforeDeleteSchedule', e);
            cal.deleteSchedule(e.schedule.id, e.schedule.calendarId);
        },
        'afterRenderSchedule': function(e) {
            var schedule = e.schedule;
            // var element = cal.getElement(schedule.id, schedule.calendarId);
            // console.log('afterRenderSchedule', element);
        },
        'clickTimezonesCollapseBtn': function(timezonesCollapsed) {
            console.log('timezonesCollapsed', timezonesCollapsed);

            if (timezonesCollapsed) {
                cal.setTheme({
                    'week.daygridLeft.width': '77px',
                    'week.timegridLeft.width': '77px'
                });
            } else {
                cal.setTheme({
                    'week.daygridLeft.width': '60px',
                    'week.timegridLeft.width': '60px'
                });
            }

            return true;
        }
    });

    document.body.querySelector('.renderer-mode-groups').addEventListener('change', evt => {
      if (evt.target.name !== 'rendererMode') {
        return;
      }

      if (evt.target.value === 'default') {
        customScheduleLayout = false;
      } else { // custom
        customScheduleLayout = {
          positionHandler: customScheduleLayoutPositionHandler
        }
      }

      if (evt.target.checked) {
        cal.setOptions({
          week: {
            customScheduleLayout
          }
        });
      }
    });
    setRenderRangeText();

    if (document.getElementById('useRandomSchedule').checked) {
      setSchedules();
    }

    setEventListener();
    function setRenderRangeText() {
          var renderRange = document.getElementById('renderRange');
          var options = cal.getOptions();
          var viewName = cal.getViewName();
          var html = [];
          if (viewName === 'day') {
              html.push(moment(cal.getDate().getTime()).format('YYYY.MM.DD'));
          } else if (viewName === 'month' &&
              (!options.month.visibleWeeksCount || options.month.visibleWeeksCount > 4)) {
              html.push(moment(cal.getDate().getTime()).format('YYYY.MM'));
          } else {
              html.push(moment(cal.getDateRangeStart().getTime()).format('YYYY.MM.DD'));
              html.push(' ~ ');
              html.push(moment(cal.getDateRangeEnd().getTime()).format(' MM.DD'));
          }
          renderRange.innerHTML = html.join('');
      }
      function setSchedules() {
          // cal.clear();
          generateSchedule(cal.getViewName(), cal.getDateRangeStart(), cal.getDateRangeEnd());
          cal.createSchedules(ScheduleList);
          // var schedules = [
          //     {id: 489273, title: 'Workout for 2019-04-05', isAllDay: false, start: '2018-02-01T11:30:00+09:00', end: '2018-02-01T12:00:00+09:00', goingDuration: 30, comingDuration: 30, color: '#ffffff', isVisible: true, bgColor: '#69BB2D', dragBgColor: '#69BB2D', borderColor: '#69BB2D', calendarId: 'logged-workout', category: 'time', dueDateClass: '', customStyle: 'cursor: default;', isPending: false, isFocused: false, isReadOnly: true, isPrivate: false, location: '', attendees: '', recurrenceRule: '', state: ''},
          //     // {id: 18073, title: 'completed with blocks', isAllDay: false, start: '2018-11-17T09:00:00+09:00', end: '2018-11-17T10:00:00+09:00', color: '#ffffff', isVisible: true, bgColor: '#54B8CC', dragBgColor: '#54B8CC', borderColor: '#54B8CC', calendarId: 'workout', category: 'time', dueDateClass: '', customStyle: '', isPending: false, isFocused: false, isReadOnly: false, isPrivate: false, location: '', attendees: '', recurrenceRule: '', state: ''}
          // ];
          // cal.createSchedules(schedules);
          //refreshScheduleVisibility();
      }
      function setEventListener() {
          $('#menu-navi').on('click', onClickNavi);
          $('#lnb-calendars').on('change', onChangeCalendars);
          $('#btn-save-schedule').on('click', onNewSchedule);
          $('#btn-new-schedule').on('click', createNewSchedule);
          $('#dropdownMenu-calendars-list').on('click', onChangeNewScheduleCalendar);
          $('#useRandomSchedule').on('click', onChangeUseRandomSchedule);
          window.addEventListener('resize', resizeThrottled);
      }
      function getDataAction(target) {
          return target.dataset ? target.dataset.action : target.getAttribute('data-action');
      }
      function resizeThrottled(event) {
        window.setTimeout(function() {
          cal.render();
        }, 50)
      }
      function onClickNavi(e) {
          var action = getDataAction(e.target);
          switch (action) {
              case 'move-prev':
                  cal.prev();
                  break;
              case 'move-next':
                  cal.next();
                  break;
              case 'move-today':
                  cal.today();
                  break;
              default:
                  return;
          }
          setRenderRangeText();

          if (document.getElementById('useRandomSchedule').checked) {
            setSchedules();
          }
      }
      function onNewSchedule() {
          var title = $('#new-schedule-title').val();
          var location = $('#new-schedule-location').val();
          var isAllDay = document.getElementById('new-schedule-allday').checked;
          var start = datePicker.getStartDate();
          var end = datePicker.getEndDate();
          var calendar = selectedCalendar ? selectedCalendar : CalendarList[0];
          if (!title) {
              return;
          }
          cal.createSchedules([{
              id: String(chance.guid()),
              calendarId: calendar.id,
              title: title,
              isAllDay: isAllDay,
              start: start,
              end: end,
              category: isAllDay ? 'allday' : 'time',
              dueDateClass: '',
              color: calendar.color,
              bgColor: calendar.bgColor,
              dragBgColor: calendar.bgColor,
              borderColor: calendar.borderColor,
              raw: {
                  location: location
              },
              state: 'Busy'
          }]);
          $('#modal-new-schedule').modal('hide');
      }
      function onChangeNewScheduleCalendar(e) {
          var target = $(e.target).closest('a[role="menuitem"]')[0];
          var calendarId = getDataAction(target);
          changeNewScheduleCalendar(calendarId);
      }
      function changeNewScheduleCalendar(calendarId) {
          var calendarNameElement = document.getElementById('calendarName');
          var calendar = findCalendar(calendarId);
          var html = [];
          html.push('<span class="calendar-bar" style="background-color: ' + calendar.bgColor + '; border-color:' + calendar.borderColor + ';"></span>');
          html.push('<span class="calendar-name">' + calendar.name + '</span>');
          calendarNameElement.innerHTML = html.join('');
          selectedCalendar = calendar;
      }
      function createNewSchedule(event) {
          var start = event.start ? new Date(event.start.getTime()) : new Date();
          var end = event.end ? new Date(event.end.getTime()) : moment().add(1, 'hours').toDate();
          if (useCreationPopup) {
              cal.openCreationPopup({
                  start: start,
                  end: end
              });
          }
      }
      function saveNewSchedule(scheduleData) {
          var calendar = scheduleData.calendar || findCalendar(scheduleData.calendarId);
          var schedule = {
              id: String(chance.guid()),
              title: scheduleData.title,
              isAllDay: scheduleData.isAllDay,
              start: scheduleData.start,
              end: scheduleData.end,
              category: scheduleData.isAllDay ? 'allday' : 'time',
              dueDateClass: '',
              color: calendar.color,
              bgColor: calendar.bgColor,
              dragBgColor: calendar.bgColor,
              borderColor: calendar.borderColor,
              location: scheduleData.location,
              raw: {
                  class: scheduleData.raw['class']
              },
              state: scheduleData.state
          };
          if (calendar) {
              schedule.calendarId = calendar.id;
              schedule.color = calendar.color;
              schedule.bgColor = calendar.bgColor;
              schedule.borderColor = calendar.borderColor;
          }
          cal.createSchedules([schedule]);
          refreshScheduleVisibility();
      }

      function onChangeUseRandomSchedule(e) {
        var checked = e.target.checked;

        if (checked) {
          setSchedules();
        } else {
          cal.clear();
          cal.createSchedules(defaultSchedules);
        }
      }

      function onChangeCalendars(e) {
          var calendarId = e.target.value;
          var checked = e.target.checked;
          var viewAll = document.querySelector('.lnb-calendars-item input');
          var calendarElements = Array.prototype.slice.call(document.querySelectorAll('#calendarList input'));
          var allCheckedCalendars = true;
          if (calendarId === 'all') {
              allCheckedCalendars = checked;
              calendarElements.forEach(function(input) {
                  var span = input.parentNode;
                  input.checked = checked;
                  span.style.backgroundColor = checked ? span.style.borderColor : 'transparent';
              });
              CalendarList.forEach(function(calendar) {
                  calendar.checked = checked;
              });
          } else {
              findCalendar(calendarId).checked = checked;
              allCheckedCalendars = calendarElements.every(function(input) {
                  return input.checked;
              });
              if (allCheckedCalendars) {
                  viewAll.checked = true;
              } else {
                  viewAll.checked = false;
              }
          }
          refreshScheduleVisibility();
      }
      function refreshScheduleVisibility() {
          var calendarElements = Array.prototype.slice.call(document.querySelectorAll('#calendarList input'));
          CalendarList.forEach(function(calendar) {
              cal.toggleSchedules(calendar.id, !calendar.checked, false);
          });
          cal.render(true);
          calendarElements.forEach(function(input) {
              var span = input.nextElementSibling;
              span.style.backgroundColor = input.checked ? span.style.borderColor : 'transparent';
          });
      }
      </script>

      <script>
        function _getScheduleWidthAndLeft(idx, schedule, leftPercent, widthPercent, afterScheduleWidth = 0, hasForcusedSchedule = false) {
          const isFocused = _.get(schedule, 'model.isFocused');
          let left = leftPercent, width = 0;

          let beforeScheduleWidth = 0;

          if (idx === 0) {
            beforeScheduleWidth = `${leftPercent}%`;

            if (hasForcusedSchedule && isFocused) {
              width = `calc(100% - (${beforeScheduleWidth} + ${afterScheduleWidth} + 9px))`;
            } else {
              width = `${DEFAULT_DUPLICATE_SCHEDULE_WIDTH}px`;
            }
          } else {
            let firstLeftValue = leftPercent ? `${leftPercent}% + ` : 0;
            beforeScheduleWidth = `${firstLeftValue ? firstLeftValue : ''}${DEFAULT_DUPLICATE_SCHEDULE_WIDTH * idx}px`;

            if (hasForcusedSchedule && !isFocused) {
              beforeScheduleWidth = `${firstLeftValue ? firstLeftValue : ''}(${widthPercent}% - ${DEFAULT_DUPLICATE_SCHEDULE_WIDTH}px)`;
              width = `${DEFAULT_DUPLICATE_SCHEDULE_WIDTH}px`;
            } else {
              if (schedule.hasCollide) {
                width = `calc(100% - (${beforeScheduleWidth} + ${afterScheduleWidth}))`;
              } else {
                width = null;
              }
            }

            left = `calc(${beforeScheduleWidth})`;
          }

          return {
            left,
            width
          }
        }
        var currViewItemEventModel;

        function _updateEventToHighlight(schedule, focus) {
            if (!schedule) {
                return;
            }

            const calendar = _.find(CalendarList, {id: schedule.calendarId});
            const isDuplicateSchedule = _.includes(schedule.customClass, 'duplicate-schedule');
            const isMajorSchedule = _.includes(schedule.customClass, 'major-schedule');
            let customClass = isDuplicateSchedule ? (focus ? 'duplicate-schedule is-focus' : 'duplicate-schedule') : schedule.customClass;
            //console.log(calendar, schedule)
            _setScheduleColors(schedule, calendar, cal.viewName, focus);
            cal.updateSchedule(schedule.id, schedule.calendarId, {
                isFocused: focus,
                color: schedule.color,
                customClass
            }, true);
            cal.render(true);
        }

        function _highlightSchedule(model) {
            _updateEventToHighlight(currViewItemEventModel, false);
            currViewItemEventModel = model;
            if (!model || _.includes(['milestone', 'task'], model.category)) {
                return;
            }

            _updateEventToHighlight(model, true);
        }

        function _setScheduleColors(schedule, calendar, viewName, useTextColor) {
          //const calendarColor = _.get(calendar, 'me.color', '#f8cf14');

          const calendarColor = _.get(calendar, 'borderColor', '#f8cf14');

          schedule.bgColor = _.get(calendar, 'bgColor', _getBgColor('#f8cf14'));
          schedule.dragBgColor = calendarColor;
          schedule.borderColor = calendarColor;
          schedule.color = calendarColor;
          /*
          if (!useTextColor && (viewName !== 'month' || _isAllDaySchedule(schedule))) {
              schedule.color = DOORAY_CALENDAR_TEXT_COLOR_MAP[calendarColor] || calendarColor;
          }
          */

          if (schedule.category === 'task') {
              schedule.borderColor = 'transparent';
              schedule.color = '#555';
          }

          if (schedule.category === 'milestone') {
              schedule.bgColor = 'transparent';
              schedule.dragBgColor = 'transparent';
              schedule.borderColor = 'transparent';
              schedule.color = calendarColor;
          }
        }



        function _getRGBA(color, opacity) {
          return color ? _getRgbaFromHexColor(color, opacity) : '#000';
        }

        function _getBgColor(color) {
          return _getRGBA(color, 0.2);
        }

        function _getRgbaFromHexColor(hex, alpha) {
            if (!hex) { return ''; }
            const [red, green, blue] = _hexToRgb(hex);

            return `rgba(${red}, ${green}, ${blue}, ${alpha})`;
        }

        function _hexToRgb(hex) {
          hex = _.startsWith(hex, '#') ? hex.substr(1) : hex;
          return hex.length === 3 ? [
              _.parseInt(hex.substr(0, 1) + hex.substr(0, 1), 16),
              _.parseInt(hex.substr(1, 1) + hex.substr(1, 1), 16),
              _.parseInt(hex.substr(2, 1) + hex.substr(2, 1), 16)
          ] : [
              _.parseInt(hex.substr(0, 2), 16),
              _.parseInt(hex.substr(2, 2), 16),
              _.parseInt(hex.substr(4, 2), 16)
          ];
        }


      </script>
  </body>
</html>
